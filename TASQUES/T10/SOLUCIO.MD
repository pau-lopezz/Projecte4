## T10: Servidor impressiÃ³ Linux. CUPS 

### Escenari de Treball
MÃ quina 1 (Servidor): Ubuntu Server configurat amb dues interfÃ­cies de xarxa: una en mode NAT i una segona en Host-Only.

![image](./IMG/1.png)

MÃ quina 2 (Client): Zorin OS (Desktop) configurat amb la mateixa estructura de xarxa que el servidor, utilitzant NAT i Host-Only.

![image](./IMG/2.png)

---

### 1. InstalÂ·laciÃ³ de CUPS al servidor

Abans dâ€™instalÂ·lar CUPS, Ã©s necessari actualitzar el sistema operatiu per assegurar-nos que disposem de les Ãºltimes versions dels paquets i correccions de seguretat. AixÃ² ajuda a evitar possibles incompatibilitats i garanteix una instalÂ·laciÃ³ mÃ©s estable del servei.

```bash
sudo apt update -y && sudo apt upgrade -y
```

![image](./IMG/3.png)

---

Un cop finalitzada lâ€™actualitzaciÃ³ del sistema, procedim a instalÂ·lar CUPS, ja que Ã©s el servei necessari per gestionar les impressores al servidor.

```bash
sudo apt install cups -y
```

![image](./IMG/4.png)

---

### 2. InstalÂ·lar impressora virtual

Per instalÂ·lar la nostra impressora virtual, accedim com a usuari root al client amb ``sudo su`` i instalÂ·lem el paquet cups-pdf, que permet crear una impressora virtual que genera arxius PDF en lloc dâ€™impressions fÃ­siques.

```bash
apt install cups-pdf
```

![image](./IMG/5.png)

---

### 3. ConfiguraciÃ³ de lâ€™administraciÃ³ de CUPS i permetre que CUPS escolti per totes les interfÃ­cies.

Per permetre lâ€™administraciÃ³ remota de CUPS i que el servei escolti per totes les interfÃ­cies de xarxa, Ã©s necessari modificar el fitxer de configuraciÃ³. Abans de fer canvis, Ã©s recomanable editar el fitxer amb cura.

Accedim a lâ€™arxiu de configuraciÃ³ amb:
```bash
sudo nano /etc/cups/cupsd.conf
```

---

Un cop dins, modifiquem les segÃ¼ents lÃ­nies per permetre connexions externes i la detecciÃ³ dâ€™impressores a la xarxa:
```bash
Listen localhost:631 â†’ Port 631
Browsing No â†’ Browsing On
```

![image](./IMG/6.png)

> El resultat final hauria de ser el que es mostra a la imatge, amb el ``Port 631`` configurat perquÃ¨ CUPS escolti per totes les interfÃ­cies i lâ€™opciÃ³ ``Browsing On`` activada per permetre la detecciÃ³ dâ€™impressores a la xarxa.

---

Ara, dins del mateix fitxer de configuraciÃ³, cal permetre lâ€™accÃ©s des de la xarxa local al servidor web de gestiÃ³ de CUPS, ja que per defecte nomÃ©s accepta connexions locals. AixÃ² ens permetrÃ  administrar el servei des dâ€™altres equips de la xarxa.

Ho fem aplicant les segÃ¼ents modificacions:

ConfiguraciÃ³ abans dels canvisâ€ƒâ€ƒâ€ƒâ€ƒ

![image](./IMG/7.png)

ConfiguraciÃ³ desprÃ©s dels canvis

![image](./IMG/8.png)

---

Un cop aplicats els canvis al fitxer de configuraciÃ³, reiniciem el servei de CUPS perquÃ¨ les modificacions tinguin efecte i comprovem que el servei estigui actiu i funcionant correctament.

```bash
systemctl restart cups && systemctl status cups
```

![image](./IMG/9.png)

---

### 4. Usant el navegador i el frontal web de CUPS compartir la impressora.

Un cop el servei estigui funcionant, accedim al panell web de gestiÃ³ de CUPS mitjanÃ§ant el navegador, ja que Ã©s la manera mÃ©s senzilla dâ€™administrar impressores i configuracions del servidor.
```bash
https://10.0.2.15:631
- 10.0.2.15 > La meva IP del enp0s3
- 631 > El port que hem configurat abans 
```
> Ã‰s normal que el navegador indiqui que es tracta dâ€™un lloc no segur, ja que CUPS utilitza un certificat autofirmat. En aquest cas, cal accedir a Avanzado â†’ Acceder a 10.0.2.15 (sitio no seguro) per continuar.

![image](./IMG/10.png)

---

Un cop realitzats aquests passos, ja haurem accedit correctament al servei de CUPS i podrem gestionar les impressores des del panell web.

![image](./IMG/11.png)

---

### 5. En el Client Zorin afegir la impressora.

A continuaciÃ³, accedim a lâ€™apartat â€œAdministraciÃ³nâ€, que es troba a la barra superior dâ€™opcions. Si el navegador torna a mostrar lâ€™avÃ­s de seguretat, procedirem de la mateixa manera que abans. En aquest cas, el sistema ens demanarÃ  iniciar sessiÃ³ amb les credencials del nostre client, ja que es tracta dâ€™una zona dâ€™administraciÃ³ del servei.

![image](./IMG/12.png)

---

Un cop dins del panell dâ€™administraciÃ³, seleccionarem lâ€™opciÃ³ â€œAfegir una impressoraâ€ per iniciar el procÃ©s de configuraciÃ³ dâ€™una nova impressora al sistema.

![image](./IMG/13.png)

---

Quan hi accedim, no seâ€™ns permetrÃ  realitzar cap acciÃ³ a causa de la falta de permisos, ja que per defecte CUPS restringeix lâ€™administraciÃ³ a usuaris autoritzats.

![image](./IMG/14.png)

---

Per aquest motiu, haurem de tornar a la terminal, entrar com a ``sudo su`` i afegir lâ€™usuari inicial al grup lpadmin, que Ã©s el grup amb permisos dâ€™administraciÃ³ de CUPS. 
```bash
usermod -aG ldapmin usuari
id usuari # Per comprovar
```
Dâ€™aquesta manera podrem gestionar impressores des del panell web.

![image](./IMG/15.png)

---

I ara, com es pot observar, ja ens permet accedir correctament. A continuaciÃ³, seleccionem la primera opciÃ³, CUPS-PDF, per configurar la impressora virtual.

![image](./IMG/16.png)

---

A continuaciÃ³, fem clic a â€œSiguienteâ€ i procedim a configurar la impressora.

![image](./IMG/17.png)

---

Seleccionem la Marca: Generic i el Model: â€œGeneric CUPS-PDF Printer (no options) (en)â€, ja que Ã©s el controlador adequat per a la impressora virtual CUPS-PDF.

![image](./IMG/18.png)

---

Un cop la configuraciÃ³ sigui igual que la mostrada a la imatge, afegim la impressora per finalitzar el procÃ©s.

![image](./IMG/19.png)

---

Podem comprovar que la impressora ja estÃ  disponible si, en utilitzar la barra de cerca, busquem â€œImpressoresâ€ i aquesta apareix correctament configurada.

![image](./IMG/20.png)

Com podem observar, la nostra impressora virtual ja estÃ  disponible i llesta per utilitzar.

![image](./IMG/21.png)

---

### 6. Fer una prova de impressiÃ³ de diversos documents

Llencem diversos treballs dâ€™impressiÃ³ des del client amb lâ€™objectiu de verificar que la comunicaciÃ³ amb el servidor CUPS funciona correctament. Dâ€™aquesta manera, podem comprovar que els treballs sâ€™envien sense errors i que apareixen correctament a la cua dâ€™impressiÃ³, indicant que el servei gestiona les peticions de manera adequada.

![image](./IMG/22.png)

---

### 7. Comprova al server com sâ€™han generat  els arxius pdf corresponents als treballs impresos.

Finalment, comprovem amb la comanda ``ls -all`` que sâ€™ha creat correctament el directori corresponent i que dins hi apareixen els arxius generats pels treballs dâ€™impressiÃ³, confirmant que la impressora virtual funciona correctament.

![image](./IMG/23.png)

---

Amb aquesta prova de concepte hem pogut comprovar el correcte funcionament del servei CUPS, des de la seva instalÂ·laciÃ³ i configuraciÃ³ fins a la gestiÃ³ dâ€™una impressora virtual accessible des del client. Les proves dâ€™impressiÃ³ realitzades confirmen que la comunicaciÃ³ entre client i servidor Ã©s correcta i que els treballs es processen adequadament, validant aixÃ­ la soluciÃ³ implementada.

---

**GrÃ cies per la teva atenciÃ³ ğŸ“Œ**

GrÃ cies per dedicar temps a revisar aquest treball.
Espero que el contingut hagi estat clar, entenedor i Ãºtil per comprendre tant el procÃ©s seguit com els resultats obtinguts. ğŸ™


![GitHub](https://img.shields.io/badge/GitHub-Pau%20Lopez-4c7cff?style=for-the-badge&logo=github&logoColor=white)
![Author](https://img.shields.io/badge/Author-Pau%20Lopez-4c7cff?style=for-the-badge)
![Sistema](https://img.shields.io/badge/Sistema-Linux-4c7cff?style=for-the-badge&logo=linux&logoColor=white)
![Servei](https://img.shields.io/badge/Servei-CUPS-4c7cff?style=for-the-badge)
![Projecte](https://img.shields.io/badge/Tipus-PoC-4c7cff?style=for-the-badge)

